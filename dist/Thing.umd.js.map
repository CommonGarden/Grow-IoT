{"version":3,"file":"Thing.umd.js","sources":["../lib/thing.js"],"sourcesContent":["const _ = require('underscore');\nconst later = require('later');\nconst EventEmitter = require('events');\n\nclass Thing extends EventEmitter {\n  /**\n   * Constructs a new Thing object. A Thing is an extension of [node's built-in \n     EventEmitter class](https://nodejs.org/api/events.html).\n   * @param {Object} config a javascript object containing metadata, properties, events, and actions\n   * @return     A new thing object\n  */\n  constructor(config) {\n    super();\n\n    if (!config) {\n      throw new Error('Thing.js requires an config object.');\n    } else {\n      _.extend(this, config);\n    }\n\n    this.registerActions();\n    this.registerEvents();\n  }\n\n  /**\n   * Starts any scheduled actions.\n   * Todo: should also throw errors if actions don't have IDs or functions.\n   */\n  registerActions () {\n    this.scheduledActions = [];\n\n    for (var action in this.actions) {\n      // TODO:\n      // Through error if no id is assigned?\n      // or perhaps generate id?\n      var actionId = this.actions[action].id;\n      \n      if (!_.isUndefined(action)) {\n        this.startAction(this.actions[action]);\n      }\n    }\n  }\n\n  /**\n   * Starts listeners and scheduled events.\n   * Todo: this needs better testing.\n   */\n  registerEvents () {\n    this.scheduledEvents = [];\n\n    // Check top level thing model for events.\n    if (!_.isUndefined(this.events)) {\n      for (var event in this.events) {\n        event = this.events[event];\n        \n        if (!_.isUndefined(event.schedule)) {\n          this.scheduleEvent(event);\n        }\n\n        if (!_.isUndefined(event.on)) {\n          this.on(event.on, () => {\n            event.function();\n          });\n        }\n      }\n    }\n  }\n\n  /**\n   * Get component object (an action or event for example) based on the id\n   * @param {String} ID  The id of the component object you want.\n   * @returns {Object}\n   */\n  getComponentByID (ID) {\n    // Check top level component\n    if (this.id === ID) {\n      return this;\n    }\n\n    // Check action and event components\n    else {\n      return _.findWhere(this.actions, {id: ID}) || _.findWhere(this.events, {id: ID});\n    }\n  }\n\n  /**\n   * Update a property based on a component ID.\n   * @param {String} componentID The id of the component to change the property of.\n   * @param {String} property The property of the component to be update.\n   * @param {String} value The value to update the property to.\n   */\n  updateComponentProperty (componentID, property, value) {\n    var component = this.getComponentByID(componentID);\n    return component[property] = value;\n  }\n\n  /**\n   * Update a property based on a component ID.\n   * @param {String} property The property of the component to be update.\n   * @param {String} value The value to update the property to.\n   */\n  setProperty (property, value) {\n    return this.properties[property] = value;\n  }\n\n  /* Get a property by name.\n   * @param {String} property\n   * @returns {String} property value.\n   */\n  getProperty (property) {\n    return this.properties[property];\n  }\n\n  /**\n   * Calls a registered action, emits event if the the action has an 'event'\n   * property defined. Updates the state if the action has an 'updateState'\n   * property specified.\n   * @param      {String}  actionId The id of the action to call.\n   * @param      {Object}  options Optional, options to call with the function.\n   */\n  callAction (actionId, options) {\n    try {\n      var action = this.getComponentByID(actionId);\n\n      if (!_.isUndefined(options)) {\n        var output = action.function(options);\n      }\n      else {\n        var output = action.function();\n      }\n      this.emit(actionId);\n\n      // We return any returns of called functions for testing.\n      if (!_.isUndefined(output)) {\n        return output;\n      }\n    }\n    catch (error) {\n      // If there is an error we emit an error.\n      return this.emit('error', error);\n    }\n\n  }\n\n  /**\n   * Starts a reoccurring action if a schedule property is defined.\n   * @param {Object} action An action object.\n   */\n  startAction (action) {\n    var schedule = later.parse.text(action.schedule);\n    var scheduledAction = later.setInterval(()=> {this.callAction(action.id);}, schedule);\n    this.scheduledActions.push(scheduledAction);\n    return scheduledAction;\n  }\n\n  /**\n   * Starts a reoccurring event if a schedule property is defined.\n   * @param {Object} event An event object.\n   */\n  scheduleEvent (event) {\n    var schedule = later.parse.text(event.schedule);\n    var scheduledEvent = later.setInterval(()=> {this.callEvent(event.id);}, schedule);\n    this.scheduledEvents.push(scheduledEvent);\n    return scheduledEvent;\n  }\n};\n\nexport default Thing;\n"],"names":[],"mappings":"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"}